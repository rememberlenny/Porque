
var $item,
    $this,
    that,
    clickedChoice,
    response = {
      holder:       '',
      textcontent:  '',
      nextquestion: ''
    },
    question = {},
    buttonChecked = false;

$(document).ready(function(){
  checkIfNoOptions();
  centerIframe();
  centerImage();
  replaceAlertWithClose();
  saveQuestions();
  buttonEventsActivate();
  setContainerSize();
  removeLoading();
});

(function() {

    /* == GLOBAL DECLERATIONS == */
    TouchMouseEvent = {
        DOWN: "touchmousedown",
        UP: "touchmouseup",
        MOVE: "touchmousemove"
    }

    /* == EVENT LISTENERS == */
    var onMouseEvent = function(event) {
        var type;

        switch (event.type) {
            case "mousedown": type = TouchMouseEvent.DOWN; break;
            case "mouseup":   type = TouchMouseEvent.UP;   break;
            case "mousemove": type = TouchMouseEvent.MOVE; break;
            default:
                return;
        }

        var touchMouseEvent = normalizeEvent(type, event, event.pageX, event.pageY);
        $(event.target).trigger(touchMouseEvent);
    }

    var onTouchEvent = function(event) {
        var type;

        switch (event.type) {
            case "touchstart": type = TouchMouseEvent.DOWN; break;
            case "touchend":   type = TouchMouseEvent.UP;   break;
            case "touchmove":  type = TouchMouseEvent.MOVE; break;
            default:
                return;
        }

        var touch = event.originalEvent.touches[0];
        var touchMouseEvent;

        if (type == TouchMouseEvent.UP)
            touchMouseEvent = normalizeEvent(type, event, null, null);
        else
            touchMouseEvent = normalizeEvent(type, event, touch.pageX, touch.pageY);

        $(event.target).trigger(touchMouseEvent);
    }

    /* == NORMALIZE == */
    var normalizeEvent = function(type, original, x, y) {
        return $.Event(type, {
            pageX: x,
            pageY: y,
            originalEvent: original
        });
    }

    /* == LISTEN TO ORIGINAL EVENT == */
    var jQueryDocument = $(document);

    if ("ontouchstart" in window) {
        jQueryDocument.on("touchstart", onTouchEvent);
        jQueryDocument.on("touchmove", onTouchEvent);
        jQueryDocument.on("touchend", onTouchEvent);
    } else {
        jQueryDocument.on("mousedown", onMouseEvent);
        jQueryDocument.on("mouseup", onMouseEvent);
        jQueryDocument.on("mousemove", onMouseEvent);
    }

})();

function removeLoading(){
  $('.loading').each(function(i, item){
    $(item).removeClass('loading');
  });
}

function setContainerSize(){
  var panelHeight = $('#panelContent').height();
  $('#panelContent').css('min-height', panelHeight);
}

function buttonEventsActivate(){
  $('.answer-choice').on(TouchMouseEvent.UP, function(){
    that = this;
    removeAllClickHandles();
    addClickPointer(that);
    if($(that).hasClass('clicked')){
      disableSubmitButton();
    }
    enableSubmitButton();
    setUpResponseModal();
  });

  $('button').on(TouchMouseEvent.UP, function(){
    passClickedToSave();
    checkForClicked();
    loadDataIntoModal();
  });

  $('.hint-button').on(TouchMouseEvent.UP, function(){
    highlightProceed();
  });

  $('.success.button').each(function(i, item){
    var savedHref = $(item).attr('href');
  });
}

function replaceAlertWithClose(){
  $('.alert.button').attr('href', 'javascript:returnQuestionContent();');
}

function closeModal(){
  $('.reveal-modal.open').foundation('reveal', 'close');
}

function highlightProceed(){
  $('.answer-choice').each(function(i, item){
    $(item).addClass('hinted');
  });
}

function centerIframe(){
  $( "iframe" ).wrap( "<div class='text-center media-container'></div>");
}

function centerImage(){
  $( "img" ).wrap( "<div class='text-center media-container'></div>");
}

function checkIfNoOptions(){
  if( !$('.answers .answer-choice') == false ){
    $('button').removeAttr('disabled');
  }
}

function enableSubmitButton(){
  if( buttonChecked === false ){
    buttonChecked = true;
  }
  if( buttonChecked === true ){
    $('button').removeAttr('disabled');
  }
}

function disableSubmitButton(){
  if( buttonChecked === true ){
    buttonChecked = false;
  }
  if( buttonChecked === false ){
    $('button').attr('disabled');
  }
}

function checkForClicked(){
  $('.answer-choice').each(function(i, item){

    checkForContent(item);

    if( $item.hasClass('clicked') ){
      clickedChoice = $item.attr('id');
    }
  });
}

function checkForContent(item){
  if($('.clicked').find('.answer-response-holder h4').html() === "Proceed"){
    console.log(item);
  }
}

function passClickedToSave(){
  clickedChoice;
}

function removeAllClickHandles(){
  $('.answer-choice').each(function(i, item){
    $item = $(item);
    if( $item.hasClass('clicked') ){
      $item.removeClass('clicked');
    }
  });
}

function addClickPointer(that){
  $this = $(that);
  $this.addClass('clicked');
}

function setUpResponseModal(){
  response.holder       = $('.clicked')[0];
  response.textcontent  = $(response.holder).find('.answer-response-holder').html();
  response.nextquestion = $(response.holder).find('.answer-response-holder').data('response');
}

function saveQuestions(){
  question.containerContent = $('#panelContent').html();
}

function returnQuestionContent(){
  $('.question-content h5').css('opacity',1);
  $('#panelContent').html(question.containerContent);
  buttonEventsActivate();
}

function loadDataIntoModal(){
  $('.question-content h5').css('opacity',.3);
  $('#panelContent').children().fadeOut(200, function(){
    $('#panelContent').html(response.textcontent);
  });
}

